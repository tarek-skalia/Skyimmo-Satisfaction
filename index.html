<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enqu√™te de Satisfaction - SKYIMMO</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #1055d5;
      --primary-light: #4A90E2;
      --primary-dark: #0a3d9e;
      --electric-blue: #00d4ff;
      --electric-purple: #8b5cf6;
      --electric-pink: #ec4899;
      --neon-green: #00ff88;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #0a0a0a;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .form-container {
      width: 100%;
      max-width: 600px;
      background: rgba(15,23,42,0.95);
      border-radius: 20px;
      padding: 30px;
      color: white;
    }

    .form-title {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 10px;
      text-align: center;
    }

    .form-subtitle {
      font-size: 16px;
      text-align: center;
      margin-bottom: 20px;
      color: #ccc;
    }

    .form-group { margin-bottom: 25px; }
    .form-label { display: block; font-weight: 600; margin-bottom: 8px; }
    .form-label.required::after { content:" *"; color: var(--electric-pink); }

    .form-select, .form-textarea {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #444;
      background: #111;
      color: white;
    }

    .rating-group { display:flex; flex-wrap:wrap; gap:10px; }
    .rating-option { flex:1; }
    .rating-input { display:none; }
    .rating-label {
      display:block;
      padding:12px;
      text-align:center;
      border:1px solid #444;
      border-radius:10px;
      cursor:pointer;
    }
    .rating-input:checked + .rating-label {
      background: linear-gradient(135deg,var(--primary),var(--electric-blue));
      color:white;
      border-color: var(--electric-blue);
    }

    .submit-container {
      text-align: center;
      margin-top: 28px;
      display: flex;
      flex-direction: column;   /* bouton au-dessus, badge en dessous */
      align-items: center;
      gap: 12px;
    }

    .submit-button {
      background: linear-gradient(135deg,var(--primary) 0%,var(--electric-blue) 100%);
      color: #fff;
      font-size: 17px;
      font-weight: 700;
      padding: 14px 40px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: .2s;
    }
    .submit-button:hover { transform: scale(1.05); }

    .security-badge {
      display: block;
      text-align: center;
      background: rgba(0,255,136,.1);
      color: var(--neon-green);
      font-size: 13px;
      font-weight: 600;
      padding: 6px 14px;
      border-radius: 25px;
      border: 1px solid rgba(0,255,136,.3);
    }

    .note { margin-top: 10px; font-size: 14px; text-align: center; }
    .hidden { display:none; }

    /* Toast message */
    #toast {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background: #333;
      color: #fff;
      text-align: center;
      border-radius: 8px;
      padding: 12px;
      position: fixed;
      left: 50%;
      bottom: 30px;
      font-size: 15px;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s, bottom 0.3s;
    }
    #toast.show {
      visibility: visible;
      opacity: 1;
      bottom: 50px;
    }
    #toast.error { background: #e53e3e; }
  </style>
</head>
<body>
  <div class="form-container">
    <h1 class="form-title">Votre avis compte !</h1>
    <p class="form-subtitle">Enqu√™te de satisfaction sur votre visite</p>

    <div id="formWrapper">
      <form id="surveyForm">
        <div class="form-group" id="group-agent">
          <label class="form-label required">Nom de l'agent rencontr√©</label>
          <select class="form-select" name="agent" required>
            <option value="">S√©lectionnez un agent...</option>
            <option value="Isma√Øl Boutgayout">Isma√Øl Boutgayout</option>
            <option value="Sarah Martin">Sarah Martin</option>
            <option value="Thomas Dubois">Thomas Dubois</option>
            <option value="Marie Leroy">Marie Leroy</option>
          </select>
        </div>

        <div class="form-group" id="group-professionnalisme">
          <label class="form-label required">Professionnalisme</label>
          <div class="rating-group">
            <div class="rating-option"><input type="radio" id="prof1" name="professionnalisme" value="1" class="rating-input"><label for="prof1" class="rating-label">Tr√®s faible</label></div>
            <div class="rating-option"><input type="radio" id="prof2" name="professionnalisme" value="2" class="rating-input"><label for="prof2" class="rating-label">Faible</label></div>
            <div class="rating-option"><input type="radio" id="prof3" name="professionnalisme" value="3" class="rating-input"><label for="prof3" class="rating-label">Moyen</label></div>
            <div class="rating-option"><input type="radio" id="prof4" name="professionnalisme" value="4" class="rating-input"><label for="prof4" class="rating-label">Bon</label></div>
            <div class="rating-option"><input type="radio" id="prof5" name="professionnalisme" value="5" class="rating-input"><label for="prof5" class="rating-label">Excellent</label></div>
          </div>
        </div>

        <div class="form-group" id="group-satisfaction">
          <label class="form-label required">Satisfaction globale</label>
          <div class="rating-group">
            <div class="rating-option"><input type="radio" id="sat1" name="satisfaction" value="1" class="rating-input"><label for="sat1" class="rating-label">üòû</label></div>
            <div class="rating-option"><input type="radio" id="sat2" name="satisfaction" value="2" class="rating-input"><label for="sat2" class="rating-label">üôÅ</label></div>
            <div class="rating-option"><input type="radio" id="sat3" name="satisfaction" value="3" class="rating-input"><label for="sat3" class="rating-label">üòê</label></div>
            <div class="rating-option"><input type="radio" id="sat4" name="satisfaction" value="4" class="rating-input"><label for="sat4" class="rating-label">üòä</label></div>
            <div class="rating-option"><input type="radio" id="sat5" name="satisfaction" value="5" class="rating-input"><label for="sat5" class="rating-label">üòç</label></div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Commentaires</label>
          <textarea class="form-textarea" name="commentaires" placeholder="Partagez vos impressions... (optionnel)"></textarea>
        </div>

        <div class="submit-container">
          <button type="submit" class="submit-button" id="submitBtn">Envoyer mon avis</button>
          <div class="security-badge">üîí Vos donn√©es sont s√©curis√©es</div>
          <p id="status" class="note"></p>
        </div>
      </form>
    </div>

    <div id="successPanel" class="hidden">
      <h2>‚ú® Merci !</h2>
      <p>Votre r√©ponse a bien √©t√© envoy√©e.</p>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    const form=document.getElementById('surveyForm');
    const statusEl=document.getElementById('status');
    const btn=document.getElementById('submitBtn');
    const toast=document.getElementById('toast');
    const formWrapper=document.getElementById('formWrapper');
    const successPanel=document.getElementById('successPanel');

    const WEBHOOK_URL="/api/submit";
    const BLOCK_DELAY=1000*60*5; // 5 minutes

    function showToast(msg,type='success'){
      toast.textContent=msg;
      toast.className=''; 
      if(type==='error') toast.classList.add('error');
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'),3000);
    }
    function showSuccessPanel(){
      formWrapper.classList.add('hidden');
      successPanel.classList.remove('hidden');
    }

    // v√©rif blocage
    const last=localStorage.getItem('skyimmo_satisfaction_time');
    if(last && Date.now()-parseInt(last,10)<BLOCK_DELAY){ showSuccessPanel(); }

    // validation simple
    function validateForm(){
      const agent=form.querySelector('select[name="agent"]');
      if(!agent.value){ showToast("‚ö†Ô∏è Veuillez s√©lectionner l'agent","error"); return false; }
      const pro=form.querySelector('input[name="professionnalisme"]:checked');
      if(!pro){ showToast("‚ö†Ô∏è Merci d'√©valuer le professionnalisme","error"); return false; }
      const sat=form.querySelector('input[name="satisfaction"]:checked');
      if(!sat){ showToast("‚ö†Ô∏è Merci d'√©valuer votre satisfaction","error"); return false; }
      return true;
    }

    form.addEventListener('submit',async(e)=>{
      e.preventDefault();
      if(!validateForm()) return;
      btn.disabled=true; statusEl.textContent="‚è≥ Envoi...";
      const fd=new FormData(form);
      const payload=Object.fromEntries(fd.entries());
      try{
        const res=await fetch(WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
        if(!res.ok) throw new Error("Erreur");
        localStorage.setItem('skyimmo_satisfaction_time',Date.now());
        showSuccessPanel();
        showToast("‚úÖ Merci, r√©ponse envoy√©e !");
      }catch(err){
        showToast("‚ùå Une erreur est survenue","error");
      }finally{ btn.disabled=false; statusEl.textContent=""; }
    });
  </script>
</body>
</html>
